# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–∏—Å—Ç–µ–º–µ —Å 12 CPU cores:

| –¢–∏–ø —Ç–µ—Å—Ç–æ–≤ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ | 2 –ø–æ—Ç–æ–∫–∞ | 4 –ø–æ—Ç–æ–∫–∞ | 12 –ø–æ—Ç–æ–∫–æ–≤ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|------------|------------|-----------------|----------|----------|------------|--------------|
| **Unit —Ç–µ—Å—Ç—ã** | 13 | 3.8 —Å–µ–∫ | 7.0 —Å–µ–∫ | 15.4 —Å–µ–∫ | 20+ —Å–µ–∫ | **1-2 –ø–æ—Ç–æ–∫–∞** |
| **Async —Ç–µ—Å—Ç—ã** | 23 | 6.7 —Å–µ–∫ | 6.7 —Å–µ–∫ | 9.2 —Å–µ–∫ | 12+ —Å–µ–∫ | **2-4 –ø–æ—Ç–æ–∫–∞** |
| **–í—Å–µ —Ç–µ—Å—Ç—ã** | 52 | 19.5 —Å–µ–∫ | 25+ —Å–µ–∫ | 20.7 —Å–µ–∫ | 25+ —Å–µ–∫ | **4-6 –ø–æ—Ç–æ–∫–æ–≤** |

### üéØ –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:

1. **Unit —Ç–µ—Å—Ç—ã (–±—ã—Å—Ç—Ä—ã–µ)**: –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è **–ù–ï —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞** –∏–∑-–∑–∞ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤
2. **Async —Ç–µ—Å—Ç—ã (–º–µ–¥–ª–µ–Ω–Ω—ã–µ)**: –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞** –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 2-4 –ø–æ—Ç–æ–∫–æ–≤
3. **–°–º–µ—à–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**: –û–ø—Ç–∏–º–∞–ª—å–Ω–æ 4-6 –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## ‚öôÔ∏è –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Makefile:

```makefile
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏
UNIT_JOBS ?= 2      # Unit —Ç–µ—Å—Ç—ã: 2 –ø–æ—Ç–æ–∫–∞
ASYNC_JOBS ?= 4     # Async —Ç–µ—Å—Ç—ã: 4 –ø–æ—Ç–æ–∫–∞
ALL_JOBS ?= 6       # –í—Å–µ —Ç–µ—Å—Ç—ã: 6 –ø–æ—Ç–æ–∫–æ–≤
```

### üöÄ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (unit, 2 –ø–æ—Ç–æ–∫–∞) - ~7 —Å–µ–∫
make test-fast

# Async —Ç–µ—Å—Ç—ã (4 –ø–æ—Ç–æ–∫–∞) - ~9 —Å–µ–∫
make test-async

# –í—Å–µ —Ç–µ—Å—Ç—ã (6 –ø–æ—Ç–æ–∫–æ–≤) - ~21 —Å–µ–∫
make test

# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏) - ~20 —Å–µ–∫
make test-serial

# –ö–∞—Å—Ç–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤
make test-custom JOBS=8
```

## üîç –ü–æ—á–µ–º—É async —Ç–µ—Å—Ç—ã –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤ –ø–∞—Ä–∞–ª–ª–µ–ª–∏?

### 1. **–ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**
- –ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å pytest-xdist —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π Python –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä
- –ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –∫–∞–∂–¥–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏

### 2. **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ async —Ç–µ—Å—Ç–æ–≤**
- Async —Ç–µ—Å—Ç—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç event loop –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å
- –ë–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏ –Ω–∞ –ø—Ä–æ—Ü–µ—Å—Å –∏–∑-–∑–∞ async runtime

### 3. **I/O bound vs CPU bound**
- **Unit —Ç–µ—Å—Ç—ã**: I/O bound (–±—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)
- **Async —Ç–µ—Å—Ç—ã**: CPU bound (—Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞, –º–æ–∫–∏, async/await)
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è CPU bound –∑–∞–¥–∞—á**

## üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:**

1. **Unit —Ç–µ—Å—Ç—ã**: 1-2 –ø–æ—Ç–æ–∫–∞ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è)
2. **Async —Ç–µ—Å—Ç—ã**: 2-4 –ø–æ—Ç–æ–∫–∞ (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å)
3. **Pre-commit**: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–±—ã—Å—Ç—Ä–æ, –ø—Ä–æ—Å—Ç–æ)
4. **CI/CD**: 4-6 –ø–æ—Ç–æ–∫–æ–≤ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

### ‚ùå **–ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–ú–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤** - –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã > –≤—ã–≥–æ–¥–∞
2. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ –¥–ª—è async** - –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã event loop
3. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∞–ª–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤** - overhead > benefit

### üéØ **–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è:**

```bash
# –î–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make test-fast          # 2 –ø–æ—Ç–æ–∫–∞, ~7 —Å–µ–∫

# –î–ª—è CI/CD
make test               # 6 –ø–æ—Ç–æ–∫–æ–≤, ~21 —Å–µ–∫

# –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
make test-serial        # 1 –ø–æ—Ç–æ–∫, ~20 —Å–µ–∫

# –î–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
make test-custom JOBS=1 # –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤:

```bash
# –¢–µ—Å—Ç —Å —Ä–∞–∑–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ—Ç–æ–∫–æ–≤
time make test-custom JOBS=1
time make test-custom JOBS=2
time make test-custom JOBS=4
time make test-custom JOBS=8
time make test-custom JOBS=12
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Makefile:

```makefile
# –î–ª—è —Å–ª–∞–±—ã—Ö –º–∞—à–∏–Ω (4-6 cores)
UNIT_JOBS ?= 1
ASYNC_JOBS ?= 2
ALL_JOBS ?= 3

# –î–ª—è –º–æ—â–Ω—ã—Ö –º–∞—à–∏–Ω (16+ cores)
UNIT_JOBS ?= 2
ASYNC_JOBS ?= 6
ALL_JOBS ?= 8
```

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è async —Ç–µ—Å—Ç–æ–≤ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª, –Ω–æ –≤ —Ä–∞–∑—É–º–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö:**

- ‚úÖ **2-4 –ø–æ—Ç–æ–∫–∞** –¥–ª—è async —Ç–µ—Å—Ç–æ–≤ - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ
- ‚ùå **12+ –ø–æ—Ç–æ–∫–æ–≤** - –∏–∑–±—ã—Ç–æ—á–Ω–æ –∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ
- ‚úÖ **1-2 –ø–æ—Ç–æ–∫–∞** –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤ - –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
- ‚úÖ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ** –¥–ª—è pre-commit - –±—ã—Å—Ç—Ä–æ –∏ –Ω–∞–¥–µ–∂–Ω–æ

**–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!** üöÄ
